{\rtf1\ansi\ansicpg1252\cocoartf2821
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 @startuml\
title UC4 Activity - Generate SQL via GenAI\
top to bottom direction\
skinparam dpi 220\
skinparam linetype ortho\
skinparam shadowing false\
skinparam roundcorner 12\
\
' =========================================================\
' TEXT DESCRIPTION (Numbered Steps)\
' Step 1: System receives user's natural language question and database schema context.\
' Step 2: System builds a secure prompt including schema, allowlist, and safety constraints.\
' Step 3: System sends the prompt to the LLM provider for SQL generation.\
' Step 4: LLM provider generates and returns a candidate SQL query.\
' Step 5: System validates SQL syntax, security policies, and allowlist compliance.\
' Step 6: System checks whether the SQL query is valid and safe.\
' Step 7: If valid, system returns SQL to controller for execution or display.\
' Step 8: System logs successful SQL generation for audit and monitoring.\
' Step 9: If invalid, system rejects SQL and returns validation error.\
' Step 10: System logs failure event for audit and security review.\
' =========================================================\
\
(*) --> "1. Receive question\\n+ schema context"\
--> "2. Build secure prompt\\n(schema, allowlist, limits)"\
--> "3. Call LLM provider"\
--> "4. Receive candidate SQL"\
--> "5. Validate SQL\\n(policy + syntax)"\
\
if "6. Valid SQL?" then\
  -->[Yes] "7. Return SQL\\nto controller"\
  --> "8. Audit log success"\
  --> (*)\
else\
  -->[No] "9. Reject SQL\\nreturn reason"\
  --> "10. Audit log failure"\
  --> (*)\
endif\
\
@enduml}