{\rtf1\ansi\ansicpg1252\cocoartf2821
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 @startuml\
title UC1 Activity - Ask BI Question in Natural Language\
top to bottom direction\
skinparam dpi 220\
skinparam linetype ortho\
skinparam shadowing false\
skinparam roundcorner 12\
\
' =========================================================\
' TEXT DESCRIPTION (Numbered Steps)\
' Step 1: User enters a business question in natural language via Web UI.\
' Step 2: Web UI sends the request to the Chat Controller.\
' Step 3: Chat Controller normalizes the question and generates a hash key.\
' Step 4: System checks cache for an existing answer.\
' Step 5: If cache hit, system returns cached answer immediately.\
' Step 6: If cache miss, system performs semantic search using vector database.\
' Step 7: System evaluates whether a semantic match is found.\
' Step 8: If semantic match found, system retrieves stored answer by reference.\
' Step 9: If no semantic match found, system generates SQL using GenAI (LLM).\
' Step 10: System validates the generated SQL for safety and correctness.\
' Step 11: If SQL valid, system executes SQL on business database.\
' Step 12: System builds chart visualization and summary from query results.\
' Step 13: System stores answer in cache for future reuse.\
' Step 14: System stores embedding in vector database for semantic reuse.\
' Step 15: If SQL invalid, system returns safe validation error.\
' Step 16: System logs the interaction for audit and monitoring.\
' Step 17: Web UI displays SQL, chart, and summary to the user.\
' =========================================================\
\
(*) --> "1. User types question\\nin natural language"\
--> "2. Web UI sends request\\nto Chat Controller"\
--> "3. Normalize text\\nand compute hashKey"\
--> "4. Try Cache lookup"\
\
if "5. Cache hit?" then\
  -->[Yes] "Return cached answer"\
else\
  -->[No] "6. Run Semantic Match\\n(Vector Search)"\
  if "7. Semantic match found?" then\
    -->[Yes] "8. Fetch stored answer\\nby reference"\
  else\
    -->[No] "9. Generate SQL via GenAI\\n(LLM)"\
    --> "10. Validate SQL"\
    if "11. SQL valid?" then\
      -->[Yes] "12. Execute SQL\\non Business DB"\
      --> "13. Build chart + summary"\
      --> "14. Store answer in Cache"\
      --> "15. Upsert embedding\\nin Vector DB"\
    else\
      -->[No] "16. Return safe error\\n(validation reason)"\
    endif\
  endif\
endif\
\
--> "17. Audit log interaction"\
--> "18. Web UI displays\\nSQL + chart + summary"\
--> (*)\
\
@enduml}